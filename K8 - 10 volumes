
## üì¶ Kubernetes Volumes ‚Äì Super Simple Notes

### üîπ What is a Volume?
- A **storage space** connected to a container.
- Used to **store data** so it's **not lost when container restarts**.
- Can also **share data between containers** in the same pod.

---

### üîπ Why Use Volumes?
- Containers are **temporary** ‚Äì data inside is lost on restart.
- Volumes help to **keep data safe** even if the container crashes or restarts.

---

### üîπ Types of Volumes (Commonly Used)

#### 1. **emptyDir**
- Created when pod starts.
- Deleted when pod is deleted.
- Used for **temporary storage** or **sharing files between containers**.
  
#### 2. **hostPath**
- Uses a folder from the **host machine**.
- Good for **testing** or **low-level access to node files**.

#### 3. **configMap**
- Used to pass **configuration files** to containers.
- Example: app settings, environment configs.

#### 4. **secret**
- Used to pass **sensitive info** like passwords or API keys.
- More secure than configMap.

#### 5. **persistentVolumeClaim (PVC)**
- Used to **store data permanently** (even if pod is deleted).
- Connects to **Persistent Volume (PV)** ‚Äì which is real storage (disk, NFS, cloud).

---

### üîπ Real-Life Use Case Example
> You have a web app pod that stores uploaded images.  
> Use a **PVC** so the images don‚Äôt get lost if the pod restarts.

---

### üîπ PV vs PVC ‚Äì Easy Comparison

| Term | Meaning |
|------|---------|
| **PV** | The actual storage (like a disk) |
| **PVC** | A request to use some of that storage |
| **Pod** | Uses the PVC to get storage access |

---

### üîπ emptyDir YAML Example

```yaml
volumes:
  - name: temp-storage
    emptyDir: {}

volumeMounts:
  - mountPath: /data
    name: temp-storage
```

‚úÖ In this case:
- A folder `/data` is created inside the container.
- It‚Äôs used while the pod is running.
- Deleted when the pod is gone.

---

### üîπ Summary Cheat Sheet

- üß† **Volume** = Keeps data safe across restarts.
- üõ†Ô∏è Use **emptyDir** for temp files.
- üîê Use **secret/configMap** for configs and passwords.
- üíæ Use **PVC** for permanent data (like DBs, file uploads).
- üß∞ **Volumes are mounted** into the container path (like `/data`).

---

Let me know if you'd like a diagram or visual explanation too!



k8s volumes
============


apiVersion: apps/v1
kind: ReplicaSet
metadata: 
  name: mongodb
  namespace: test-ns
spec:
  replicas: 1
  selector: 
    matchLabels:
      app: mongodb
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
      - name: mongocon
        image: mongo
        ports:
        - containerPort: 27017
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          value: devdb
        - name: MONGO_INITDB_ROOT_PASSWORD
          value: devdb@123
---
apiVersion: v1
kind: Service
metadata:
  name: mongosvc
  namespace: test-ns
spec:
  type: ClusterIP
  selector:
    app: mongodb
  ports:
    - port: 27017
      targetPort: 27017





==================================


apiVersion: apps/v1
kind: Deployment
metadata:
  name: springapp
  namespace: dev 
spec:
  replicas: 2
  selector: 
    matchLabels:
      app: springapp
  template:
    metadata:
      labels:
        app: springapp
    spec:  
      containers:
      - name: springapp
        image: kkeducation12345/spring-app:1.0.0
        ports:
        - containerPort: 8080
        env:
        - name: MONGO_DB_HOSTNAME
          value: mongosvc
        - name: MONGO_DB_USERNAME
          value: devdb
        - name: MONGO_DB_PASSWORD
          value: devdb@123
        resources:
          requests:
            cpu: 300m
            memory: 256Mi
          limits:
            cpu: 500m  
            memory: 512Mi
---
apiVersion: v1
kind: Service
metadata:
  name: springappsvc
  namespace: dev
spec:
  type: NodePort
  selector:
    app: springapp
  ports:
  - port: 80
    targetPort: 8080




kubectl exec -it <pod-Name> -n <NS> -- ls /data/db



======================================================


---> After adding host path volumes



apiVersion: apps/v1
kind: ReplicaSet
metadata: 
  name: mongodb
  namespace: dev
spec:
  replicas: 1
  selector: 
    matchLabels:
      app: mongodb
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
      - name: mongocon
        image: mongo
        ports:
        - containerPort: 27017
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          value: devdb
        - name: MONGO_INITDB_ROOT_PASSWORD
          value: devdb@123
        volumeMounts:
        - name: mongovol
          mountPath: /data/db
      volumes:
      - name: mongovol
        hostPath:
          path: /mongodata
---
apiVersion: v1
kind: Service
metadata:
  name: mongosvc
  namespace: dev
spec:
  type: ClusterIP
  selector:
    app: mongodb
  ports:
    - port: 27017
      targetPort: 27017



==================

NFS volumes in k8s
===================


emptyDir
HosptPath Volumes


--> explain the diagram

setup the NFS server
====================

step 1: launch an ec2 m/c and connect to that machine

step 2: update the package manager.

sudo apt update -y

step 3: Allow the traffic to 2049 port.

step 4: install the nfs software

sudo apt install nfs-kernel-server -y

step 5: create nfs shared directory

sudo mkdir -p /mnt/nfs_share

sudo chown nobody:nogroup -R /mnt/nfs_share/

sudo chmod 777 -R /mnt/nfs_share/

step 6: Assign the server access to the clients through NFS export file.


sudo vi /etc/exports

/mnt/nfs_share/ *(rw,sync,no_subtree_check,no_root_squash)


step 7: export the shared directory

sudo exportfs -a

sudo systemctl restart nfs-kernel-server

step 8: check the nfs process is running or not

ps -ef|grep -i "nfs"



configuring the nfs client machine
==================================

--> Install in all the machines of k8s cluster

sudo apt update -y

sudo apt install nfs-common -y


apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: mongodb
  namespace: dev
spec:
  selector:
    matchLabels:
      app: mongodb
  replicas: 1
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
      - name: mongocon
        image: mongo
        ports:
        - containerPort: 27017
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          value: devdb
        - name: MONGO_INITDB_ROOT_PASSWORD
          value: devdb@123
        volumeMounts:
        - name: mongonfsvol
          mountPath: /data/db
      volumes:
      - name: mongonfsvol
        nfs:
         server: 172.31.27.140
         path: /mnt/nfs_share

---
apiVersion: v1
kind: Service
metadata:
  name: mongosvc
  namespace: dev
spec:
  type: ClusterIP
  selector:
    app: mongodb
  ports:
    - port: 27017
      targetPort: 27017


==================================


--> PV and PVC

apiVersion: v1
kind: PersistentVolume
metadata:
  name: mongodb-pv
spec:
  capacity:
    storage: 1Gi  # Adjust as necessary
  accessModes:
    - ReadWriteMany  # NFS supports this
  nfs:
    server: 172.31.41.65  # Your NFS server IP
    path: /mnt/nfs_share  # Path on your NFS server



apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mongodb-pvc
  namespace: dev # This is correct
spec:
  accessModes:
    - ReadWriteMany  # Must match the PV's access mode
  resources:
    requests:
      storage: 1Gi  # Must match or be less than the PV's size
---
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: mongodb
  namespace: dev
spec:
  selector:
    matchLabels:
      app: mongodb
  replicas: 1
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
      - name: mongocon
        image: mongo
        ports:
        - containerPort: 27017
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          value: devdb
        - name: MONGO_INITDB_ROOT_PASSWORD
          value: devdb@123
        volumeMounts:
        - name: mongonfsvol
          mountPath: /data/db
      volumes:
      - name: mongonfsvol
        persistentVolumeClaim:
          claimName: mongodb-pvc  
---
apiVersion: v1
kind: Service
metadata:
  name: mongosvc
  namespace: dev
spec:
  type: ClusterIP
  selector:
    app: mongodb
  ports:
    - port: 27017
      targetPort: 27017
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sprinapp
  namespace: test-ns
spec:
  replicas: 2
  selector:
    matchLabels:
      app: springapp
  template:
    metadata:
      labels:
        app: springapp
    spec:
      containers:
      - name: springapp
        image: kkeducation12345/spring-app:1.0.0
        ports:
        - containerPort: 8080
        env:
        - name: MONGO_DB_HOSTNAME
          value: mongosvc
        - name: MONGO_DB_USERNAME
          value: devdb
        - name: MONGO_DB_PASSWORD
          value: devdb@123
        resources:
          requests:
            cpu: 300m
            memory: 256Mi
          limits:
            cpu: 500m
            memory: 512Mi
---
apiVersion: v1
kind: Service
metadata:
  name: springappsvc
  namespace: test-ns
spec:
 type: NodePort
 selector:
   app: springapp
 ports:
 - port: 80
   targetPort: 8080
   

NOTE: pv and pvc are 1 to 1 relationship


          










============================================
